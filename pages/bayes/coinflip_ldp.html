<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jakob Hoffmann">
<meta name="dcterms.date" content="2023-01-01">

<title>Learning Julia - Bayesian inference for a sequence of coinflips</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Bayesian inference for a sequence of coinflips</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Learning Julia</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../agenda.html" class="sidebar-item-text sidebar-link">Agenda</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Programming basics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/programming_recap.html" class="sidebar-item-text sidebar-link">Exercises</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Statistical rethinking</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/statistical-rethinking/week1.html" class="sidebar-item-text sidebar-link">Week 1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/statistical-rethinking/week2.html" class="sidebar-item-text sidebar-link">Week 2</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#about-this-tutorial" id="toc-about-this-tutorial" class="nav-link active" data-scroll-target="#about-this-tutorial">About this tutorial</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#model-definition" id="toc-model-definition" class="nav-link" data-scroll-target="#model-definition">Model definition</a></li>
  <li><a href="#model-estimation" id="toc-model-estimation" class="nav-link" data-scroll-target="#model-estimation">Model estimation</a></li>
  <li><a href="#model-checking" id="toc-model-checking" class="nav-link" data-scroll-target="#model-checking">Model checking</a></li>
  <li><a href="#model-inference" id="toc-model-inference" class="nav-link" data-scroll-target="#model-inference">Model inference</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Bayesian inference for a sequence of coinflips</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jakob Hoffmann </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="about-this-tutorial" class="level2">
<h2 class="anchored" data-anchor-id="about-this-tutorial">About this tutorial</h2>
<p>This is a tutorial on how to use the <code>LogDensityProblems.jl</code> ecosystem for Bayesian inference. Compared to other packages, such as <code>Turing.jl</code>, this approach is a bit more low-level, with the upside of being more hackable and being insightful for learning purposes.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>For this exercise, we’re interested in performing inference on a simple data-generating process where a possibly biased coin is flipped <span class="math inline">\(N=100\)</span> times. More formally, we could state this like so:</p>
<p><span class="math display">\[
y_i \sim \mathrm{Bernoulli}(p) \textrm{ for } i = 1,2,...,100
\]</span></p>
<p>We start by simulating data from a Bernoulli distribution with the probability of heads set to <span class="math inline">\(p = 0.7\)</span>, which for the inverse problem is going to be the unknown quantity of interest to be inferred from observed data.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="fl">100</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="fu">Bernoulli</span>(p)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="fu">rand</span>(d, N);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p><em>Note</em>: The avid reader will notice that this problem could also be more efficiently represented by making use of independence between the flips, in which case we could just record the total number of flips and the number of heads and make use of the binomial distribution. However, for sake of consistency we here stick to the Bernoulli representation.</p>
</blockquote>
</section>
<section id="model-definition" class="level2">
<h2 class="anchored" data-anchor-id="model-definition">Model definition</h2>
<p>Having simulated data for inference, we now proceed to the model definition using the <code>LogDensityProblems</code> interface package. We store the flips in a struct called <code>CoinflipProblem</code>:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> CoinflipProblem</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  flips<span class="op">::</span><span class="dt">Vector{Bool}</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The centerpiece of most modern Bayesian inference methods is the unnormalized log probability density function of the posterior distribution, which indicates how well a given parameter value fits the evidence provided by our data (encoded in the loglikelihood function) and our prior beliefs. For our numerical estimation procedure, it guides our search of the parameter space to obtain a representative set of draws from the posterior distribution.</p>
<p>We start by specifying the loglikelihood function, which, for a given value <span class="math inline">\(p\)</span>, is the sum of the log probability densities of each of our flips under a <span class="math inline">\(\textrm{Bernoulli}(p)\)</span> distribution:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">loglik</span>(p<span class="op">::</span><span class="dt">Real</span>, flips<span class="op">::</span><span class="dt">Vector{Bool}</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(y <span class="op">-&gt;</span> <span class="fu">logpdf</span>(<span class="fu">Bernoulli</span>(p), y), flips)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next to the likelihood function which makes use of the information from the data, we also need to specify a prior distribution which encodes our prior (before having seen the data) belief about <span class="math inline">\(p\)</span>. Here, we’re going to be broadly skeptical of extremely biased coins and use a <span class="math inline">\(\mathrm{Beta}(2,2)\)</span> prior:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">logpri</span>(p<span class="op">::</span><span class="dt">Real</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">2</span>,<span class="fl">2</span>), p)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s a plot of what that looks like:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Beta</span>(<span class="fl">2</span>,<span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<p><img src="coinflip_ldp_files/figure-html/cell-8-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>We now make our problem struct callable on an input parameter <span class="math inline">\(\theta\)</span>, which is just a ‘container’ holding our actual parameter of interest, <span class="math inline">\(p\)</span>, but could also contain other parameters. Calling the struct on a given <span class="math inline">\(\theta\)</span> returns the sum of the log density of the prior and the log likelihood, a.k.a. the log posterior density evaluated at <span class="math inline">\(p\)</span>.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> (problem<span class="op">::</span><span class="dt">CoinflipProblem</span>)(θ)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  (; flips) <span class="op">=</span> problem</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  (; p) <span class="op">=</span> θ</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logpri</span>(p) <span class="op">+</span> <span class="fu">loglik</span>(p, flips)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can instantiate our <code>CoinflipProblem</code> with the data and call it to evaluate the log posterior density at a couple of values for <span class="math inline">\(p\)</span>:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>problem <span class="op">=</span> <span class="fu">CoinflipProblem</span>(data)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">problem</span>((; p<span class="op">=</span><span class="fl">0.1</span>)), <span class="fu">problem</span>((; p<span class="op">=</span><span class="fl">0.5</span>)), <span class="fu">problem</span>((; p<span class="op">=</span><span class="fl">0.9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>(-171.54963185075027, -68.90925294788643, -70.47730129328443)</code></pre>
</div>
</div>
<p>While the actual values of the log posterior density are not immediately that useful, we can already infer that, given the data and our prior beliefs, <span class="math inline">\(p=0.5\)</span> is deemed similarly likely compared to <span class="math inline">\(p=0.9\)</span> and much more likely than <span class="math inline">\(p=0.1\)</span>.</p>
</section>
<section id="model-estimation" class="level2">
<h2 class="anchored" data-anchor-id="model-estimation">Model estimation</h2>
<p>Having defined a way to evaluate the posterior density for a given parameter value, we now want a full representation of the posterior distribution to draw conclusions about the coin. While for simple problems, like the one presented here, a closed-form analytical solution is available, a more general method which also works for complicated models is to draw a large number of samples from the posterior distribution. Based on these samples, one can easily derive statements about certain summaries of the posterior distribution (e.g., its mean and standard deviation) or visualize it.</p>
<p>A general purpose numerical procedure for obtaining samples from the posterior distribution, using the unnormalized log posterior density function (as specified above) and its gradient, is Hamiltonian Monte Carlo (HMC) and its variants.</p>
<p>As more of an implementation detail, HMC operates on the unconstrained reals but our parameter <span class="math inline">\(p\)</span> is confined to the unit interval <span class="math inline">\((0,1)\)</span> so we need an appropriate transformation, which is conveniently available in the <code>TransformedLogDensities</code> package. As mentioned, HMC furthermore requires the gradient of the posterior density, which we can conveniently obtain via automatic differentiation, in this case using the <code>ForwardDiff</code> package.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">TransformVariables</span>, <span class="bu">TransformedLogDensities</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>transformation <span class="op">=</span> <span class="fu">as</span>((p<span class="op">=</span>as_unit_interval,))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>tran <span class="op">=</span> <span class="fu">TransformedLogDensity</span>(transformation, problem)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="op">:</span>ForwardDiff, tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>ForwardDiff AD wrapper for TransformedLogDensity of dimension 1, w/ chunk size 1</code></pre>
</div>
</div>
<p>We can now evaluate the logdensity and its gradient:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(grad, <span class="fu">zeros</span>(<span class="fl">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>(-70.29554730900632, [23.0])</code></pre>
</div>
</div>
<p>With this in place, we can now draw a large number of samples (say, <span class="math inline">\(S=2000\)</span>) from the posterior distribution using the HMC implementation in <code>DynamicHMC</code>. We use the <code>ThreadsX</code> package to sample <span class="math inline">\(k\)</span> chains in parallel:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicHMC</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ThreadsX</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sample</span>(grad, S, k; rng<span class="op">=</span><span class="bu">Random</span>.<span class="fu">default_rng</span>()) </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>   ThreadsX.<span class="fu">map</span>(<span class="fl">1</span><span class="op">:</span>k) <span class="cf">do</span> _</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mcmc_with_warmup</span>(rng, grad, S; reporter<span class="op">=</span><span class="fu">NoProgressReport</span>())</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="fu">sample</span>(grad, <span class="fl">2000</span>, <span class="fl">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>4-element Vector{NamedTuple{(:posterior_matrix, :tree_statistics, :κ, :ϵ), Tuple{Matrix{Float64}, Vector{DynamicHMC.TreeStatisticsNUTS}, GaussianKineticEnergy{LinearAlgebra.Diagonal{Float64, Vector{Float64}}, LinearAlgebra.Diagonal{Float64, Vector{Float64}}}, Float64}}}:
 (posterior_matrix = [1.0058940995780696 1.0605630001032291 … 1.324558672493981 1.1884766295323521], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-60.39014100493384, 2, turning at positions 0:3, 0.910988062043864, 3, DynamicHMC.Directions(0xd9111d8b)), DynamicHMC.TreeStatisticsNUTS(-60.074474827326554, 2, turning at positions 0:3, 0.9539617157746445, 3, DynamicHMC.Directions(0xd0c40807)), DynamicHMC.TreeStatisticsNUTS(-60.89710601788657, 1, turning at positions 1:2, 0.8283087846124366, 3, DynamicHMC.Directions(0xeab21336)), DynamicHMC.TreeStatisticsNUTS(-64.8266259972107, 2, turning at positions -2:1, 0.5324468251200921, 3, DynamicHMC.Directions(0x379fcfd5)), DynamicHMC.TreeStatisticsNUTS(-63.365031302412476, 1, turning at positions -1:0, 0.9351010505904543, 1, DynamicHMC.Directions(0x80333792)), DynamicHMC.TreeStatisticsNUTS(-62.15526687733028, 1, turning at positions -2:-3, 0.9999999999999999, 3, DynamicHMC.Directions(0xad89e82c)), DynamicHMC.TreeStatisticsNUTS(-60.98864166881967, 1, turning at positions 0:1, 0.8264712688343019, 1, DynamicHMC.Directions(0x2287f241)), DynamicHMC.TreeStatisticsNUTS(-60.7189886382524, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0x57a684b5)), DynamicHMC.TreeStatisticsNUTS(-61.186740105501904, 1, turning at positions 0:1, 0.7083416553312581, 1, DynamicHMC.Directions(0xcdbf96c9)), DynamicHMC.TreeStatisticsNUTS(-61.2845266262707, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0xcf6c1339))  …  DynamicHMC.TreeStatisticsNUTS(-61.00321115408256, 2, turning at positions -2:1, 0.9943797310263487, 3, DynamicHMC.Directions(0x0dbabc6d)), DynamicHMC.TreeStatisticsNUTS(-61.047888656611754, 1, turning at positions -1:-2, 0.7326699634540859, 3, DynamicHMC.Directions(0xbe2650ad)), DynamicHMC.TreeStatisticsNUTS(-64.45222688267648, 1, turning at positions 0:1, 0.3112007310233998, 1, DynamicHMC.Directions(0x6991ce45)), DynamicHMC.TreeStatisticsNUTS(-63.32537118182135, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0x9a3e5aff)), DynamicHMC.TreeStatisticsNUTS(-60.8088562509901, 2, turning at positions -1:2, 0.9999999999999999, 3, DynamicHMC.Directions(0xc37cfcda)), DynamicHMC.TreeStatisticsNUTS(-61.72423897728738, 1, turning at positions 1:2, 0.6753774263783744, 3, DynamicHMC.Directions(0x944c7baa)), DynamicHMC.TreeStatisticsNUTS(-60.31076701652606, 2, turning at positions -1:2, 0.9950350863840173, 3, DynamicHMC.Directions(0x1064eaee)), DynamicHMC.TreeStatisticsNUTS(-60.280276380924505, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0x7f7d7717)), DynamicHMC.TreeStatisticsNUTS(-61.14739805160589, 1, turning at positions 0:1, 0.7680370952414641, 1, DynamicHMC.Directions(0x64b07d03)), DynamicHMC.TreeStatisticsNUTS(-60.975435178921074, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0xc9afa82d))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.20892271624687506], ϵ = 1.1411133715429909)
 (posterior_matrix = [1.0727989942951228 0.8119528888152521 … 0.79908682835979 1.145090046107464], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-60.08969967838724, 1, turning at positions 1:2, 0.9550710000631782, 3, DynamicHMC.Directions(0xe3fdcc32)), DynamicHMC.TreeStatisticsNUTS(-60.33438721213265, 1, turning at positions -1:-2, 0.9526179012068448, 3, DynamicHMC.Directions(0x7a9d7689)), DynamicHMC.TreeStatisticsNUTS(-60.1715475879722, 2, turning at positions -1:2, 0.9724428142580819, 3, DynamicHMC.Directions(0xb1a919f2)), DynamicHMC.TreeStatisticsNUTS(-59.82026160690279, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0xaabc9baf)), DynamicHMC.TreeStatisticsNUTS(-61.73936489907677, 2, turning at positions 0:3, 0.7580581009786758, 3, DynamicHMC.Directions(0xd0d13d77)), DynamicHMC.TreeStatisticsNUTS(-60.8676308181903, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0xe2ae375d)), DynamicHMC.TreeStatisticsNUTS(-62.876377035941815, 1, turning at positions -1:-2, 0.6828729299052569, 3, DynamicHMC.Directions(0x7580a1f9)), DynamicHMC.TreeStatisticsNUTS(-61.49700608189974, 1, turning at positions 0:1, 0.7452739995541132, 1, DynamicHMC.Directions(0x606ba1ab)), DynamicHMC.TreeStatisticsNUTS(-62.09989115596749, 2, turning at positions -2:1, 0.9092315215293502, 3, DynamicHMC.Directions(0xd3eee089)), DynamicHMC.TreeStatisticsNUTS(-59.788980535794785, 1, turning at positions -2:-3, 0.9999999999999999, 3, DynamicHMC.Directions(0x42e7b9e0))  …  DynamicHMC.TreeStatisticsNUTS(-61.17718618474947, 1, turning at positions -1:-2, 0.8026263013117916, 3, DynamicHMC.Directions(0x228645c1)), DynamicHMC.TreeStatisticsNUTS(-60.925086694731476, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0xe1cd431d)), DynamicHMC.TreeStatisticsNUTS(-59.8291123709329, 2, turning at positions 0:3, 0.9925449407500818, 3, DynamicHMC.Directions(0x3389b7eb)), DynamicHMC.TreeStatisticsNUTS(-59.91067528787149, 1, turning at positions 1:2, 0.977774157007917, 3, DynamicHMC.Directions(0x466184ee)), DynamicHMC.TreeStatisticsNUTS(-59.833820533481365, 1, turning at positions 2:3, 0.9999999999999999, 3, DynamicHMC.Directions(0xe7661eeb)), DynamicHMC.TreeStatisticsNUTS(-60.19603740968348, 2, turning at positions 0:3, 0.9427396847040601, 3, DynamicHMC.Directions(0x6268e46b)), DynamicHMC.TreeStatisticsNUTS(-60.1491868678926, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0x7cd311e2)), DynamicHMC.TreeStatisticsNUTS(-60.78554403869777, 2, turning at positions -2:1, 0.9048927860167173, 3, DynamicHMC.Directions(0xd8d596a1)), DynamicHMC.TreeStatisticsNUTS(-60.68190243497294, 2, turning at positions 0:3, 0.9091906066477812, 3, DynamicHMC.Directions(0xf327c7ff)), DynamicHMC.TreeStatisticsNUTS(-60.802989891345995, 1, turning at positions 1:2, 0.8967900773259979, 3, DynamicHMC.Directions(0xa3fe8a22))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.22867098010810216], ϵ = 0.9616116131710419)
 (posterior_matrix = [0.9825714471634304 0.9660592973663192 … 1.049439559959976 1.0664098504698984], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-59.86950379409712, 2, turning at positions 0:3, 0.9821743734991469, 3, DynamicHMC.Directions(0x04294b57)), DynamicHMC.TreeStatisticsNUTS(-60.350702558010035, 2, turning at positions 0:3, 0.9093688311452613, 3, DynamicHMC.Directions(0xb67758ef)), DynamicHMC.TreeStatisticsNUTS(-60.10015446478, 2, turning at positions 0:3, 0.9541728156974032, 3, DynamicHMC.Directions(0xdc737477)), DynamicHMC.TreeStatisticsNUTS(-60.70160044312167, 1, turning at positions 1:2, 0.8927288964840648, 3, DynamicHMC.Directions(0x19219e02)), DynamicHMC.TreeStatisticsNUTS(-60.58155292812043, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0x363c6e52)), DynamicHMC.TreeStatisticsNUTS(-60.33294601338947, 1, turning at positions 0:1, 0.9689293554448278, 1, DynamicHMC.Directions(0x6ab23c8d)), DynamicHMC.TreeStatisticsNUTS(-61.199231371924256, 2, turning at positions 0:3, 0.8979441260214336, 3, DynamicHMC.Directions(0xb4fe3513)), DynamicHMC.TreeStatisticsNUTS(-61.79718062459656, 2, turning at positions 0:3, 0.7288270730495577, 3, DynamicHMC.Directions(0xd6e20047)), DynamicHMC.TreeStatisticsNUTS(-60.05845620645043, 1, turning at positions 2:3, 0.9987579663974852, 3, DynamicHMC.Directions(0x1863b79f)), DynamicHMC.TreeStatisticsNUTS(-60.168099440057524, 2, turning at positions 0:3, 0.953297948697112, 3, DynamicHMC.Directions(0x6198ee47))  …  DynamicHMC.TreeStatisticsNUTS(-59.914162563504576, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0xa1bf7516)), DynamicHMC.TreeStatisticsNUTS(-60.733017478605426, 2, turning at positions 0:3, 0.8666746419531125, 3, DynamicHMC.Directions(0xab881503)), DynamicHMC.TreeStatisticsNUTS(-62.20523522219133, 1, turning at positions -1:-2, 0.5511972372395637, 3, DynamicHMC.Directions(0x4b1708d9)), DynamicHMC.TreeStatisticsNUTS(-60.546748532682265, 1, turning at positions -1:0, 0.9225157589157382, 1, DynamicHMC.Directions(0x03b2b2b4)), DynamicHMC.TreeStatisticsNUTS(-62.5399485754696, 2, turning at positions -2:1, 0.8203085852951834, 3, DynamicHMC.Directions(0xbd3ffc29)), DynamicHMC.TreeStatisticsNUTS(-62.03560488153044, 2, turning at positions -1:2, 0.9999999999999999, 3, DynamicHMC.Directions(0x1e6bcdee)), DynamicHMC.TreeStatisticsNUTS(-62.376984567973054, 1, turning at positions -1:0, 0.6170848930876548, 1, DynamicHMC.Directions(0x65c425a2)), DynamicHMC.TreeStatisticsNUTS(-61.976449516622, 2, turning at positions -1:2, 0.9999999999999999, 3, DynamicHMC.Directions(0xff11559e)), DynamicHMC.TreeStatisticsNUTS(-59.98995546133357, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0x9ce8e01b)), DynamicHMC.TreeStatisticsNUTS(-59.91852529573208, 2, turning at positions -1:2, 0.9968995037839125, 3, DynamicHMC.Directions(0xc9b32d46))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.20161543408220398], ϵ = 1.1129093597211068)
 (posterior_matrix = [0.5446751487088308 0.47595745309505827 … 1.2177538893936102 1.0845875208159415], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-62.078930987611365, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0x0079d62d)), DynamicHMC.TreeStatisticsNUTS(-62.53871102728392, 1, turning at positions 0:1, 0.8463528017943344, 1, DynamicHMC.Directions(0xac184d15)), DynamicHMC.TreeStatisticsNUTS(-62.984824969986164, 1, turning at positions 0:1, 0.9578594383350257, 1, DynamicHMC.Directions(0x3f97355b)), DynamicHMC.TreeStatisticsNUTS(-62.967451406638276, 1, turning at positions -2:-3, 0.9366488148091735, 3, DynamicHMC.Directions(0xe094b71c)), DynamicHMC.TreeStatisticsNUTS(-59.84587330199332, 1, turning at positions -1:-2, 0.9883861994712538, 3, DynamicHMC.Directions(0xf2d63ca9)), DynamicHMC.TreeStatisticsNUTS(-59.860492059994236, 2, turning at positions -1:2, 0.9945446217174254, 3, DynamicHMC.Directions(0x4daac392)), DynamicHMC.TreeStatisticsNUTS(-59.97874511035256, 2, turning at positions 5:6, 0.9740976317272955, 7, DynamicHMC.Directions(0xcad4c916)), DynamicHMC.TreeStatisticsNUTS(-60.11178392593013, 2, turning at positions 5:6, 0.9710105727920981, 7, DynamicHMC.Directions(0x6e5b0f6e)), DynamicHMC.TreeStatisticsNUTS(-60.53453681477102, 1, turning at positions -1:0, 0.9103845892446467, 1, DynamicHMC.Directions(0xffbc5c80)), DynamicHMC.TreeStatisticsNUTS(-60.46537246703829, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0x5b37ec36))  …  DynamicHMC.TreeStatisticsNUTS(-60.321758673442794, 1, turning at positions -1:0, 0.9190423635138688, 1, DynamicHMC.Directions(0xca1bb21e)), DynamicHMC.TreeStatisticsNUTS(-60.27559247253089, 1, turning at positions -2:-3, 0.996401182474261, 3, DynamicHMC.Directions(0xf1e3a5a0)), DynamicHMC.TreeStatisticsNUTS(-62.05413826931228, 2, turning at positions -3:0, 0.7173369273952792, 3, DynamicHMC.Directions(0xf6e63dfc)), DynamicHMC.TreeStatisticsNUTS(-60.50542723229151, 1, turning at positions 2:3, 0.9892675838648665, 3, DynamicHMC.Directions(0x614aa61b)), DynamicHMC.TreeStatisticsNUTS(-60.60064377801833, 2, turning at positions -3:0, 0.9183252504264824, 3, DynamicHMC.Directions(0xef865bac)), DynamicHMC.TreeStatisticsNUTS(-60.19434665190732, 1, turning at positions -2:-3, 0.9732944596878762, 3, DynamicHMC.Directions(0x0f91d030)), DynamicHMC.TreeStatisticsNUTS(-60.00172987397604, 2, turning at positions 0:3, 0.9747810925179953, 3, DynamicHMC.Directions(0x5bff1e6f)), DynamicHMC.TreeStatisticsNUTS(-59.97334674040486, 1, turning at positions 1:2, 0.9869947520622174, 3, DynamicHMC.Directions(0xb1aaf11e)), DynamicHMC.TreeStatisticsNUTS(-60.62668539044079, 1, turning at positions -1:-2, 0.8772252974382639, 3, DynamicHMC.Directions(0xe7995169)), DynamicHMC.TreeStatisticsNUTS(-60.711002299455124, 2, turning at positions -1:2, 0.9800512439519286, 3, DynamicHMC.Directions(0x3aecea42))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.20629709778957428], ϵ = 0.9671849948793995)</code></pre>
</div>
</div>
<p>The <code>result</code> is a vector of length <span class="math inline">\(k\)</span>, each element of which contains for each chain the posterior samples as well as some statistics about the sampling procedure, which can be used to check if everything went as planned.</p>
</section>
<section id="model-checking" class="level2">
<h2 class="anchored" data-anchor-id="model-checking">Model checking</h2>
<p>Having obtained samples from the posterior distribution, we’re in principle ready to use our model for inference, i.e., answer the question of whether our coin is biased and by how much, and how certain we can be of the answer based on the data we have seen.</p>
<p>However, before we jump to inference, it is good practice to perform some model checks: Our estimates rely on a numerical sampling scheme, which can fail, rendering the results unreliable.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MCMCDiagnosticTools</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicHMC.Diagnostics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, we can check the effective sample size (ess). In Markov chain monte carlo (MCMC) approaches, samples are often correlated, meaning that the total number of ‘effective’ samples is less than obtained by an uncorrelated sampling procedure because consecutive samples carry some of the same information.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ess, Rhat <span class="op">=</span>  <span class="fu">ess_rhat</span>(<span class="fu">stack_posterior_matrices</span>(result))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>([2821.153267550686], [1.0009676808218122])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_tree_statistics</span>.(<span class="fu">getfield</span>.(result, <span class="op">:</span>tree_statistics))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>4-element Vector{DynamicHMC.Diagnostics.TreeStatisticsSummary{Float64, NamedTuple{(:max_depth, :divergence, :turning), Tuple{Int64, Int64, Int64}}}}:
 Hamiltonian Monte Carlo sample of length 2000
  acceptance rate mean: 0.91, 5/25/50/75/95%: 0.64 0.86 0.97 1.0 1.0
  termination: divergence =&gt; 0%, max_depth =&gt; 0%, turning =&gt; 100%
  depth: 0 =&gt; 0%, 1 =&gt; 62%, 2 =&gt; 38%
 Hamiltonian Monte Carlo sample of length 2000
  acceptance rate mean: 0.92, 5/25/50/75/95%: 0.65 0.88 0.97 1.0 1.0
  termination: divergence =&gt; 0%, max_depth =&gt; 0%, turning =&gt; 100%
  depth: 0 =&gt; 0%, 1 =&gt; 65%, 2 =&gt; 35%
 Hamiltonian Monte Carlo sample of length 2000
  acceptance rate mean: 0.92, 5/25/50/75/95%: 0.68 0.89 0.97 1.0 1.0
  termination: divergence =&gt; 0%, max_depth =&gt; 0%, turning =&gt; 100%
  depth: 0 =&gt; 0%, 1 =&gt; 65%, 2 =&gt; 35%
 Hamiltonian Monte Carlo sample of length 2000
  acceptance rate mean: 0.94, 5/25/50/75/95%: 0.74 0.91 0.97 1.0 1.0
  termination: divergence =&gt; 0%, max_depth =&gt; 0%, turning =&gt; 100%
  depth: 0 =&gt; 0%, 1 =&gt; 59%, 2 =&gt; 41%</code></pre>
</div>
</div>
</section>
<section id="model-inference" class="level2">
<h2 class="anchored" data-anchor-id="model-inference">Model inference</h2>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StructArrays</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">posterior</span>(result)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  samples <span class="op">=</span> <span class="fu">eachcol</span>(<span class="fu">pool_posterior_matrices</span>(result))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">StructArray</span>(<span class="fu">transform</span>.(transformation, samples))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> <span class="fu">posterior</span>(result);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">summarize</span>(post)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  m, s <span class="op">=</span> <span class="fu">round</span>.((<span class="fu">mean</span>(post.p), <span class="fu">std</span>(post.p)); digits<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">println</span>(<span class="st">"posterior mean: "</span>, m)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">println</span>(<span class="st">"posterior sd: "</span>, s)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(post)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>posterior mean: 0.72
posterior sd: 0.04</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_inferred_vs_true</span>(post, p_true)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  fig <span class="op">=</span> <span class="fu">Figure</span>(); ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>])</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">density!</span>(ax, post.p; color<span class="op">=:</span>grey20)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vlines!</span>(ax, p_true; linewidth<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  fig</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_inferred_vs_true</span>(post, p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<p><img src="coinflip_ldp_files/figure-html/cell-19-output-1.svg" class="img-fluid"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>