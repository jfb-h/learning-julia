<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jakob Hoffmann">
<meta name="dcterms.date" content="2023-01-01">

<title>Learning Julia - Bayesian inference for a sequence of coinflips</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Bayesian inference for a sequence of coinflips</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Learning Julia</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../agenda.html" class="sidebar-item-text sidebar-link">Agenda</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Programming basics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/programming_recap.html" class="sidebar-item-text sidebar-link">Exercises</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">Julia fundamentals</span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">Tabular data</span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">Data visualization</span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Bayesian modeling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/bayes/coinflip_ldp.html" class="sidebar-item-text sidebar-link active">Simple coinflip model</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#about-this-tutorial" id="toc-about-this-tutorial" class="nav-link active" data-scroll-target="#about-this-tutorial">About this tutorial</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#model-definition" id="toc-model-definition" class="nav-link" data-scroll-target="#model-definition">Model definition</a></li>
  <li><a href="#model-estimation" id="toc-model-estimation" class="nav-link" data-scroll-target="#model-estimation">Model estimation</a></li>
  <li><a href="#model-checking" id="toc-model-checking" class="nav-link" data-scroll-target="#model-checking">Model checking</a></li>
  <li><a href="#model-inference" id="toc-model-inference" class="nav-link" data-scroll-target="#model-inference">Model inference</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Bayesian inference for a sequence of coinflips</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jakob Hoffmann </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="about-this-tutorial" class="level2">
<h2 class="anchored" data-anchor-id="about-this-tutorial">About this tutorial</h2>
<p>This is a tutorial on how to use the <code>LogDensityProblems.jl</code> ecosystem for Bayesian inference. Compared to other packages, such as <code>Turing.jl</code>, this approach is a bit more low-level, with the upside of being more hackable and insightful for learning.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>For this exercise, we’re interested in performing inference on a simple process where a possibly biased coin is flipped <span class="math inline">\(N=100\)</span> times. More formally, we could state this like so:</p>
<p><span class="math display">\[
y_i \sim \mathrm{Bernoulli}(p) \textrm{ for } i = 1,2,...100
\]</span></p>
<p>We start by simulating data from a Bernoulli distribution with the probability of heads set to <span class="math inline">\(p = 0.7\)</span>, which for the inverse problem is going to be the unknown quantity of interest to be inferred from observed data.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="fl">100</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="fu">Bernoulli</span>(p)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="fu">rand</span>(d, N);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-definition" class="level2">
<h2 class="anchored" data-anchor-id="model-definition">Model definition</h2>
<p>Having simulated data for inference, we now proceed to the model definition using the <code>LogDensityProblems</code> interface package. As we assume that the individual coinflips are independent from one another, the exact sequence of flips is irrelevant and we just need to store the total number of flips, <span class="math inline">\(N\)</span>, and the number of heads, which we call <span class="math inline">\(y\)</span>. We store this information in a struct called <code>CoinflipProblem</code>, for which we also create a constructor that extracts the necessary information from a sequence of flips.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> CoinflipProblem</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  N<span class="op">::</span><span class="dt">Int</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  y<span class="op">::</span><span class="dt">Int</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">CoinflipProblem</span>(data<span class="op">::</span><span class="dt">AbstractVector{Bool}</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  N, y <span class="op">=</span> <span class="fu">length</span>(data), <span class="fu">sum</span>(data)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">CoinflipProblem</span>(N, y)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now make our problem struct callable on an input parameter <span class="math inline">\(\theta\)</span> at which to evaluate the (unnormalized) log joint probability density of the posterior distribution. Next to the likelihood function which makes use of the information from the data, we also need to specify a prior distribution for the unknown quantities. Here, we’re going to be broadly skeptical of extremely biased coins and use a <span class="math inline">\(Beta(2,2)\)</span> prior:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Beta</span>(<span class="fl">2</span>,<span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<p><img src="coinflip_ldp_files/figure-html/cell-6-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> (problem<span class="op">::</span><span class="dt">CoinflipProblem</span>)(θ)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  (; N, y) <span class="op">=</span> problem</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  (; p) <span class="op">=</span> θ</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  logprior <span class="op">=</span> <span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">2</span>,<span class="fl">2</span>), p)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  loglikelihood <span class="op">=</span> <span class="fu">logpdf</span>(<span class="fu">Binomial</span>(N, p), y)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  logprior <span class="op">+</span> loglikelihood</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now instantiate our problem on the data and evaluate the joint logdensity of a fair coinflip with <span class="math inline">\(p = 0.5\)</span>:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>problem <span class="op">=</span> <span class="fu">CoinflipProblem</span>(data)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">problem</span>((; p<span class="op">=</span><span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>-11.128639802309163</code></pre>
</div>
</div>
</section>
<section id="model-estimation" class="level2">
<h2 class="anchored" data-anchor-id="model-estimation">Model estimation</h2>
<p>Having defined a way to evaluate the posterior density for a given parameter value, we now proceed to set up a sampling-based numeric estimation procedure via Hamiltonian</p>
<p>Monte Carlo (HMC) using the <code>LogDensityProblems</code> suite of packages. HMC operates on the unconstrained reals but our parameter <span class="math inline">\(p\)</span> is confined to the unit interval <span class="math inline">\((0,1)\)</span> so we need an appropriate transformation, which is conveniently available in the <code>TransformedLogDensity</code> package. HMC furthermore requires the gradient of the posterior density, which we get with an automatic differentiation package, in this case <code>ForwardDiff</code>.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">TransformVariables</span>, <span class="bu">TransformedLogDensities</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>transformation <span class="op">=</span> <span class="fu">as</span>((p<span class="op">=</span>as_unit_interval,))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>tran <span class="op">=</span> <span class="fu">TransformedLogDensity</span>(transformation, problem)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="op">:</span>ForwardDiff, tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>ForwardDiff AD wrapper for TransformedLogDensity of dimension 1, w/ chunk size 1</code></pre>
</div>
</div>
<p>We can now evaluate the logdensity and its gradient:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(grad, <span class="fu">zeros</span>(<span class="fl">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>(-12.514934163429054, [21.0])</code></pre>
</div>
</div>
<p>With this in place, we can now draw a large number of samples (say, <span class="math inline">\(S=2000\)</span>) from the posterior distribution using the HMC implementation in <code>DynamicHMC</code> as an approximation. We use the <code>ThreadsX</code> package to sample <span class="math inline">\(k\)</span> chains in parallel:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicHMC</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ThreadsX</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sample</span>(grad, S, k; rng<span class="op">=</span><span class="bu">Random</span>.<span class="fu">default_rng</span>()) </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>   ThreadsX.<span class="fu">map</span>(<span class="fl">1</span><span class="op">:</span>k) <span class="cf">do</span> _</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mcmc_with_warmup</span>(rng, grad, S; reporter<span class="op">=</span><span class="fu">NoProgressReport</span>())</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="fu">sample</span>(grad, <span class="fl">2000</span>, <span class="fl">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>4-element Vector{NamedTuple{(:posterior_matrix, :tree_statistics, :κ, :ϵ), Tuple{Matrix{Float64}, Vector{DynamicHMC.TreeStatisticsNUTS}, GaussianKineticEnergy{LinearAlgebra.Diagonal{Float64, Vector{Float64}}, LinearAlgebra.Diagonal{Float64, Vector{Float64}}}, Float64}}}:
 (posterior_matrix = [0.7594784155396775 0.8732662922782356 … 0.7623168266503462 0.9556723841564525], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-3.9558427307386883, 3, turning at positions -5:2, 0.9932275979286667, 7, DynamicHMC.Directions(0x929120ea)), DynamicHMC.TreeStatisticsNUTS(-4.005481924377945, 1, turning at positions -1:-2, 0.9903061330073557, 3, DynamicHMC.Directions(0xed977dd5)), DynamicHMC.TreeStatisticsNUTS(-4.741564843709749, 1, turning at positions -1:-2, 0.9043113872438543, 3, DynamicHMC.Directions(0x8703000d)), DynamicHMC.TreeStatisticsNUTS(-4.777478670199526, 1, turning at positions -1:0, 0.9213406205026133, 1, DynamicHMC.Directions(0x8454f578)), DynamicHMC.TreeStatisticsNUTS(-5.174298799996222, 3, turning at positions -4:3, 0.9720997509000432, 7, DynamicHMC.Directions(0x7447d973)), DynamicHMC.TreeStatisticsNUTS(-4.405002502113046, 1, turning at positions 1:2, 0.9492728959680495, 3, DynamicHMC.Directions(0x48df7572)), DynamicHMC.TreeStatisticsNUTS(-3.9373253021064274, 3, turning at positions -4:3, 0.9997449439750703, 7, DynamicHMC.Directions(0x6c49667b)), DynamicHMC.TreeStatisticsNUTS(-3.824255509860001, 1, turning at positions 0:1, 0.9979572722072216, 1, DynamicHMC.Directions(0x9dd41ea3)), DynamicHMC.TreeStatisticsNUTS(-4.162795289066665, 1, turning at positions 1:2, 0.9643580166870344, 3, DynamicHMC.Directions(0x27cc5ef6)), DynamicHMC.TreeStatisticsNUTS(-4.975161818200692, 2, turning at positions -3:0, 0.9050260813212447, 3, DynamicHMC.Directions(0xdb012850))  …  DynamicHMC.TreeStatisticsNUTS(-4.146609428300096, 1, turning at positions -1:-2, 0.9617041414606181, 3, DynamicHMC.Directions(0x61a3dbbd)), DynamicHMC.TreeStatisticsNUTS(-4.281821681085967, 2, turning at positions -3:0, 0.9687577769713936, 3, DynamicHMC.Directions(0x4bc49ba0)), DynamicHMC.TreeStatisticsNUTS(-3.937213900974066, 2, turning at positions 0:3, 0.9921509342343012, 3, DynamicHMC.Directions(0x52ce5077)), DynamicHMC.TreeStatisticsNUTS(-3.90854017951612, 3, turning at positions -4:3, 0.999924576046097, 7, DynamicHMC.Directions(0xa574773b)), DynamicHMC.TreeStatisticsNUTS(-6.687183168623831, 3, turning at positions -5:2, 0.7846044174195363, 7, DynamicHMC.Directions(0x52e6c39a)), DynamicHMC.TreeStatisticsNUTS(-6.293663797835621, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0x1779d51b)), DynamicHMC.TreeStatisticsNUTS(-6.128973270036204, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0xa185d751)), DynamicHMC.TreeStatisticsNUTS(-5.961602270365008, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0xf6f0c365)), DynamicHMC.TreeStatisticsNUTS(-5.724591782137433, 3, turning at positions -7:0, 0.9869412657746593, 7, DynamicHMC.Directions(0xd93818a0)), DynamicHMC.TreeStatisticsNUTS(-3.9390418690054108, 3, turning at positions -3:4, 0.9972132965532431, 7, DynamicHMC.Directions(0x3659fc84))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.23600914716484572], ϵ = 0.7024475266252667)
 (posterior_matrix = [1.095364824669379 1.009706222695519 … 0.776996662938031 0.8200624829558945], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-5.916699995550589, 2, turning at positions -3:0, 0.7399869285376619, 3, DynamicHMC.Directions(0x17e1d2f0)), DynamicHMC.TreeStatisticsNUTS(-4.3154376579197775, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0x53c0378a)), DynamicHMC.TreeStatisticsNUTS(-4.091276348993771, 2, turning at positions -1:2, 0.9926913649722345, 3, DynamicHMC.Directions(0xaf47b0d6)), DynamicHMC.TreeStatisticsNUTS(-3.8074104492312912, 1, turning at positions 2:3, 0.9992063670529903, 3, DynamicHMC.Directions(0xfefc3c3f)), DynamicHMC.TreeStatisticsNUTS(-3.8213651669035977, 2, turning at positions -3:0, 0.9955506621368743, 3, DynamicHMC.Directions(0x6991e310)), DynamicHMC.TreeStatisticsNUTS(-4.390568835510126, 1, turning at positions 1:2, 0.8895297871058153, 3, DynamicHMC.Directions(0x5f086716)), DynamicHMC.TreeStatisticsNUTS(-4.912371373567833, 1, turning at positions -1:0, 0.8242985166207224, 1, DynamicHMC.Directions(0xa7ce3a88)), DynamicHMC.TreeStatisticsNUTS(-5.733844831478203, 1, turning at positions -1:0, 0.593584878278383, 1, DynamicHMC.Directions(0x40ed8084)), DynamicHMC.TreeStatisticsNUTS(-4.639203981608336, 1, turning at positions -1:0, 0.9519655873711442, 1, DynamicHMC.Directions(0x6b8bde26)), DynamicHMC.TreeStatisticsNUTS(-5.292371535623847, 2, turning at positions -1:2, 0.913217108528991, 3, DynamicHMC.Directions(0xce7fadf6))  …  DynamicHMC.TreeStatisticsNUTS(-4.5201080905569215, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0x412ff07d)), DynamicHMC.TreeStatisticsNUTS(-4.34155329546376, 1, turning at positions -1:-2, 0.898546804804247, 3, DynamicHMC.Directions(0xaf6426d5)), DynamicHMC.TreeStatisticsNUTS(-4.4672951336428435, 1, turning at positions -1:0, 0.989786468776283, 1, DynamicHMC.Directions(0x293a3c82)), DynamicHMC.TreeStatisticsNUTS(-4.301024168600244, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0xd313cb24)), DynamicHMC.TreeStatisticsNUTS(-4.0680787276347505, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0x1b1fb51d)), DynamicHMC.TreeStatisticsNUTS(-4.476221868629287, 1, turning at positions -1:-2, 0.9353502463497794, 3, DynamicHMC.Directions(0xa368e091)), DynamicHMC.TreeStatisticsNUTS(-4.870724754939856, 2, turning at positions 0:3, 0.8938053820567426, 3, DynamicHMC.Directions(0xf7d681db)), DynamicHMC.TreeStatisticsNUTS(-3.9247565122376153, 2, turning at positions -1:2, 0.9999999999999999, 3, DynamicHMC.Directions(0x147f9fe6)), DynamicHMC.TreeStatisticsNUTS(-3.896387104282721, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0x700ef9c2)), DynamicHMC.TreeStatisticsNUTS(-3.9090493592558904, 2, turning at positions -2:1, 0.9930901746903801, 3, DynamicHMC.Directions(0x5edf0425))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.22023059184708757], ϵ = 0.9670902312093931)
 (posterior_matrix = [0.8759616038365876 1.049404613973033 … 0.4439291856468853 1.1724843181603468], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-3.9161572932359308, 1, turning at positions -2:-3, 0.996513314993548, 3, DynamicHMC.Directions(0x23b2c9d4)), DynamicHMC.TreeStatisticsNUTS(-4.237674859269585, 1, turning at positions -1:-2, 0.9105130510437132, 3, DynamicHMC.Directions(0x4c22c74d)), DynamicHMC.TreeStatisticsNUTS(-4.100460690113631, 1, turning at positions 2:3, 0.9999999999999999, 3, DynamicHMC.Directions(0x88d237eb)), DynamicHMC.TreeStatisticsNUTS(-3.8553841950682552, 1, turning at positions -1:0, 0.9963935461538531, 1, DynamicHMC.Directions(0x53b3786e)), DynamicHMC.TreeStatisticsNUTS(-3.96744475637226, 1, turning at positions 0:1, 0.9697580729101893, 1, DynamicHMC.Directions(0xc6305083)), DynamicHMC.TreeStatisticsNUTS(-3.9477751233776273, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0x6284d85d)), DynamicHMC.TreeStatisticsNUTS(-4.302123473723335, 2, turning at positions -3:0, 0.9396017353039365, 3, DynamicHMC.Directions(0x4f4fe070)), DynamicHMC.TreeStatisticsNUTS(-4.670157055764224, 2, turning at positions 0:3, 0.8803313297769609, 3, DynamicHMC.Directions(0xe54d64fb)), DynamicHMC.TreeStatisticsNUTS(-4.840951252382841, 1, turning at positions 0:1, 0.8158516551397657, 1, DynamicHMC.Directions(0x90ae6c6f)), DynamicHMC.TreeStatisticsNUTS(-6.047775612742106, 2, turning at positions -2:1, 0.907975731369202, 3, DynamicHMC.Directions(0x356e13d9))  …  DynamicHMC.TreeStatisticsNUTS(-6.254713123929089, 1, turning at positions 0:1, 0.9019822261237938, 1, DynamicHMC.Directions(0x2eca203f)), DynamicHMC.TreeStatisticsNUTS(-6.168164552311735, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0x9c441849)), DynamicHMC.TreeStatisticsNUTS(-5.74507119876186, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0x99a15edc)), DynamicHMC.TreeStatisticsNUTS(-6.868680631486182, 1, turning at positions 0:1, 0.7196691086351881, 1, DynamicHMC.Directions(0xd4142db7)), DynamicHMC.TreeStatisticsNUTS(-6.582083548041698, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0x143c0523)), DynamicHMC.TreeStatisticsNUTS(-5.050348991612097, 1, turning at positions -2:-3, 0.9928052734207288, 3, DynamicHMC.Directions(0xf49ef54c)), DynamicHMC.TreeStatisticsNUTS(-7.609459319197358, 2, turning at positions 0:3, 0.6624261387098597, 3, DynamicHMC.Directions(0x0586c21b)), DynamicHMC.TreeStatisticsNUTS(-9.96443957048685, 1, turning at positions 1:2, 0.7614271203993971, 3, DynamicHMC.Directions(0x4b3dd54a)), DynamicHMC.TreeStatisticsNUTS(-6.167597360542137, 1, turning at positions -1:0, 0.9180048727643397, 1, DynamicHMC.Directions(0xbf4a0b5a)), DynamicHMC.TreeStatisticsNUTS(-8.141510476698528, 1, turning at positions 2:3, 0.7238910556386994, 3, DynamicHMC.Directions(0x81fe7d5b))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.2266750443915952], ϵ = 0.9780439648091386)
 (posterior_matrix = [1.1261372139226968 1.122476953640615 … 0.6361312976464863 1.0132806898352789], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-4.557459834433942, 1, turning at positions -1:0, 0.8927040644855728, 1, DynamicHMC.Directions(0xfe4cc820)), DynamicHMC.TreeStatisticsNUTS(-4.719260215253543, 2, turning at positions -1:2, 0.9999999999999999, 3, DynamicHMC.Directions(0x48ffa13e)), DynamicHMC.TreeStatisticsNUTS(-4.411741375779766, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0xbedab811)), DynamicHMC.TreeStatisticsNUTS(-4.004313096810316, 2, turning at positions -1:2, 0.9999999999999999, 3, DynamicHMC.Directions(0x467ea5d2)), DynamicHMC.TreeStatisticsNUTS(-6.299589136615504, 1, turning at positions 1:2, 0.6249635945147176, 3, DynamicHMC.Directions(0xd2b2e596)), DynamicHMC.TreeStatisticsNUTS(-7.749906704733832, 1, turning at positions -1:0, 0.6804723610991542, 1, DynamicHMC.Directions(0x0d3fa118)), DynamicHMC.TreeStatisticsNUTS(-5.852834997185765, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0x6e2749c0)), DynamicHMC.TreeStatisticsNUTS(-4.958830927104583, 2, turning at positions -1:2, 0.9815129605961711, 3, DynamicHMC.Directions(0x0fad8422)), DynamicHMC.TreeStatisticsNUTS(-3.9567797719149027, 1, turning at positions 1:2, 0.9703090538372207, 3, DynamicHMC.Directions(0xf9b629fa)), DynamicHMC.TreeStatisticsNUTS(-4.4137016221315575, 1, turning at positions 1:2, 0.9090675241660038, 3, DynamicHMC.Directions(0x7fdd309a))  …  DynamicHMC.TreeStatisticsNUTS(-4.8848014453307425, 1, turning at positions 0:1, 0.8308424656484448, 1, DynamicHMC.Directions(0x2843b41d)), DynamicHMC.TreeStatisticsNUTS(-4.768300562317468, 2, turning at positions -1:2, 0.9999999999999999, 3, DynamicHMC.Directions(0x8a1a2e5e)), DynamicHMC.TreeStatisticsNUTS(-4.32656186815084, 2, turning at positions -1:2, 0.9999999999999999, 3, DynamicHMC.Directions(0xd81782ee)), DynamicHMC.TreeStatisticsNUTS(-4.113013061646573, 1, turning at positions 0:1, 1.0, 1, DynamicHMC.Directions(0x786b23eb)), DynamicHMC.TreeStatisticsNUTS(-4.701563914310919, 1, turning at positions 1:2, 0.8648360222214807, 3, DynamicHMC.Directions(0x4964cd4a)), DynamicHMC.TreeStatisticsNUTS(-4.577918365037704, 1, turning at positions -1:0, 1.0, 1, DynamicHMC.Directions(0x6fad8ee6)), DynamicHMC.TreeStatisticsNUTS(-5.163067574690821, 2, turning at positions -3:0, 0.8888081442274959, 3, DynamicHMC.Directions(0x877a86e0)), DynamicHMC.TreeStatisticsNUTS(-5.2737016376270915, 1, turning at positions 1:2, 0.7510305120340441, 3, DynamicHMC.Directions(0xf2f4424a)), DynamicHMC.TreeStatisticsNUTS(-8.057470384473017, 2, turning at positions -2:1, 0.6865273626110757, 3, DynamicHMC.Directions(0xddf29eb5)), DynamicHMC.TreeStatisticsNUTS(-4.960265927322879, 1, turning at positions -2:-3, 0.9208451357308879, 3, DynamicHMC.Directions(0x289dbc24))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.19504579719780102], ϵ = 1.128552966350167)</code></pre>
</div>
</div>
<p>The <code>result</code> is a vector of length <span class="math inline">\(k\)</span>, each element of which contains for each chain the posterior samples as well as some statistics about the sampling procedure, which can be used to check if everything went as planned.</p>
</section>
<section id="model-checking" class="level2">
<h2 class="anchored" data-anchor-id="model-checking">Model checking</h2>
<p>Having obtained samples from the posterior distribution, we’re in principle ready to use our model for inference, i.e., answer the question of whether our coin is biased and by how much, and how certain we can be of the answer based on the data we have seen.</p>
<p>However, before we jump to inference, it is good practice to perform some model checks: Our estimates rely on a numerical sampling scheme, which can fail rendering the results unreliable.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MCMCDiagnosticTools</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicHMC.Diagnostics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, we chan check the effective sample size (ess). In Markov chain monte carlo (MCMC) approaches, samples are often correlated, meaning that the total number of ‘effective’ samples is less than obtained by an uncorrelated sampling procedure.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ess, Rhat <span class="op">=</span>  <span class="fu">ess_rhat</span>(<span class="fu">stack_posterior_matrices</span>(result))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>([2535.115687671174], [0.9999393165064014])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_tree_statistics</span>.(<span class="fu">getfield</span>.(result, <span class="op">:</span>tree_statistics))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>4-element Vector{DynamicHMC.Diagnostics.TreeStatisticsSummary{Float64, NamedTuple{(:max_depth, :divergence, :turning), Tuple{Int64, Int64, Int64}}}}:
 Hamiltonian Monte Carlo sample of length 2000
  acceptance rate mean: 0.96, 5/25/50/75/95%: 0.84 0.94 0.98 1.0 1.0
  termination: divergence =&gt; 0%, max_depth =&gt; 0%, turning =&gt; 100%
  depth: 0 =&gt; 0%, 1 =&gt; 50%, 2 =&gt; 27%, 3 =&gt; 22%
 Hamiltonian Monte Carlo sample of length 2000
  acceptance rate mean: 0.92, 5/25/50/75/95%: 0.69 0.89 0.97 1.0 1.0
  termination: divergence =&gt; 0%, max_depth =&gt; 0%, turning =&gt; 100%
  depth: 0 =&gt; 0%, 1 =&gt; 64%, 2 =&gt; 36%
 Hamiltonian Monte Carlo sample of length 2000
  acceptance rate mean: 0.92, 5/25/50/75/95%: 0.68 0.88 0.97 1.0 1.0
  termination: divergence =&gt; 0%, max_depth =&gt; 0%, turning =&gt; 100%
  depth: 0 =&gt; 0%, 1 =&gt; 64%, 2 =&gt; 36%
 Hamiltonian Monte Carlo sample of length 2000
  acceptance rate mean: 0.92, 5/25/50/75/95%: 0.65 0.88 0.97 1.0 1.0
  termination: divergence =&gt; 0%, max_depth =&gt; 0%, turning =&gt; 100%
  depth: 0 =&gt; 0%, 1 =&gt; 69%, 2 =&gt; 31%</code></pre>
</div>
</div>
</section>
<section id="model-inference" class="level2">
<h2 class="anchored" data-anchor-id="model-inference">Model inference</h2>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StructArrays</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">posterior</span>(result)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  samples <span class="op">=</span> <span class="fu">eachcol</span>(<span class="fu">pool_posterior_matrices</span>(result))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">StructArray</span>(<span class="fu">transform</span>.(transformation, samples))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> <span class="fu">posterior</span>(result);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">summarize</span>(post)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  m, s <span class="op">=</span> <span class="fu">round</span>.((<span class="fu">mean</span>(post.p), <span class="fu">std</span>(post.p)); digits<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">println</span>(<span class="st">"posterior mean: "</span>, m)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">println</span>(<span class="st">"posterior sd: "</span>, s)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(post)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>posterior mean: 0.7
posterior sd: 0.04</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_inferred_vs_true</span>(post, p_true)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  fig <span class="op">=</span> <span class="fu">Figure</span>(); ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>])</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">density!</span>(ax, post.p; color<span class="op">=:</span>grey20)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vlines!</span>(ax, p_true; linewidth<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  fig</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_inferred_vs_true</span>(post, p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<p><img src="coinflip_ldp_files/figure-html/cell-17-output-1.svg" class="img-fluid"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>